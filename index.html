<!DOCTYPE html>

<html>
<head>
  <meta charset="utf-8" />
  <title>Mini-Game Generator Prototype</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial; padding: 20px; max-width:900px; margin:0 auto; background:#f7f9fc; color:#111; }
    header { display:flex; justify-content:space-between; align-items:center; }
    h1 { margin:0; font-size:1.4rem; }
    .controls { margin-top:16px; display:flex; gap:8px; }
    .card { background:white; padding:16px; border-radius:10px; box-shadow:0 6px 20px rgba(20,30,60,0.06); margin-top:16px; }
    button { padding:8px 12px; border-radius:8px; border:1px solid rgba(0,0,0,0.08); background:#fff; cursor:pointer; }
    #game-area { min-height:200px; display:flex; align-items:center; justify-content:center; }
    .admin { font-size:0.9rem; margin-top:12px; color:#333; }
    textarea { width:100%; min-height:60px; }
    .thumbs { display:flex; gap:12px; align-items:center; margin-top:8px; }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; background:#e6f4ea; color:#0a7a3b; font-weight:600; }
    .small { font-size:0.9rem; color:#666; }
    .game-title { font-weight:700; margin-bottom:6px; }
  </style>
</head>
<body>
  <header>
    <h1>Mini-Game Generator (Prototype)</h1>
    <div class="small">Local demo ‚Äî reviews saved in localStorage</div>
  </header>

  <div class="controls">
    <button id="btn-new">Generate Random Game</button>
    <button id="btn-play">Play Current Game</button>
    <button id="btn-admin">Show Admin</button>
  </div>

  <div id="main" class="card">
    <div id="game-meta" class="small">No game generated yet. Click <strong>Generate Random Game</strong>.</div>
    <div id="game-area"></div>
    <div id="play-end" style="display:none;" class="card">
      <div class="game-title" id="end-title"></div>
      <div>How was this mini-game?</div>
      <div class="thumbs">
        <button id="like">üëç Like</button>
        <button id="dislike">üëé Dislike</button>
      </div>
      <div style="margin-top:8px;">
        <textarea id="review-text" placeholder="Optional feedback (will be shown in admin)"></textarea>
      </div>
      <div style="margin-top:8px;">
        <button id="submit-review">Submit Review</button>
      </div>
    </div>
  </div>

  <div id="admin-panel" class="card" style="display:none;">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div><strong>Admin Panel (local)</strong> <span class="small">‚Äî view plays & reviews</span></div>
      <div><button id="clear-local">Clear Local Data</button></div>
    </div>
    <div id="admin-content" style="margin-top:10px;"></div>
  </div>

  <script>
    /********* Simple mini-game templates *********/
    const templates = [
      {
        id: 'click-speed',
        name: 'Click Speed (5 sec)',
        description: 'Click as many times as you can in 5 seconds.',
        run: (container, done) => {
          container.innerHTML = '';
          const btn = document.createElement('button');
          btn.textContent = 'Click me!';
          btn.style.padding = '20px 30px';
          btn.style.fontSize = '18px';
          let count = 0;
          btn.onclick = () => { count++; btn.textContent = 'Clicks: ' + count; };
          container.appendChild(btn);
          const info = document.createElement('div'); info.style.marginTop='12px'; container.appendChild(info);
          let timeLeft = 5;
          info.textContent = 'Time left: ' + timeLeft + 's';
          const timer = setInterval(() => {
            timeLeft--;
            info.textContent = 'Time left: ' + timeLeft + 's';
            if (timeLeft <= 0) {
              clearInterval(timer);
              done({score: count});
            }
          }, 1000);
        }
      },
      {
        id: 'dodge-box',
        name: 'Dodge the Box (10 moves)',
        description: 'Press left/right to dodge the moving box. Survive 10 steps.',
        run: (container, done) => {
          container.innerHTML = '';
          let pos = 1; // 0 left, 1 center, 2 right
          let player = 1;
          let step = 0;
          const lane = document.createElement('div'); lane.style.display='flex'; lane.style.gap='12px';
          const cells = [];
          for (let i=0;i<3;i++){
            const c = document.createElement('div'); c.style.width='80px'; c.style.height='80px'; c.style.border='1px solid #ddd'; c.style.display='flex'; c.style.alignItems='center'; c.style.justifyContent='center'; lane.appendChild(c); cells.push(c);
          }
          const playerEl = document.createElement('div'); playerEl.textContent='üôÇ'; playerEl.style.fontSize='28px'; cells[player].appendChild(playerEl);
          container.appendChild(lane);
          const info = document.createElement('div'); info.style.marginTop='12px'; container.appendChild(info);
          function render(){
            cells.forEach(c=>c.innerHTML='');
            cells[player].appendChild(playerEl);
            info.textContent = `Step ${step}/10`;
          }
          render();
          function nextStep(){
            // obstacle chooses random lane
            pos = Math.floor(Math.random()*3);
            step++;
            // check collision
            if (pos === player) {
              done({score: step, survived:false});
            } else if (step >= 10) {
              done({score: step, survived:true});
            } else {
              render();
            }
          }
          window.addEventListener('keydown', keyHandler = (e)=>{
            if (e.key === 'ArrowLeft' && player>0) player--;
            if (e.key === 'ArrowRight' && player<2) player++;
            render();
          });
          // progress every 800ms
          const timer = setInterval(() => {
            nextStep();
            if (step >= 10) {
              clearInterval(timer);
              window.removeEventListener('keydown', keyHandler);
            }
          }, 800);
        }
      },
      {
        id: 'memory-tiles',
        name: 'Memory Tiles (match 3 pairs)',
        description: 'Find matching pairs. Click tiles to reveal.',
        run: (container, done) => {
          container.innerHTML = '';
          const symbols = ['‚òÖ','‚óè','‚ñ†','‚ñ≤','‚ô•','‚óÜ'];
          const deck = symbols.slice(0,3).flatMap(s=>[s,s]); // 3 pairs
          deck.sort(()=>Math.random()-0.5);
          const grid = document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='repeat(3,100px)'; grid.style.gap='10px';
          const state = {revealed:[], matches:0};
          deck.forEach((sym,i)=>{
            const tile = document.createElement('button'); tile.style.height='80px'; tile.style.fontSize='24px';
            tile.textContent = '?';
            tile.onclick = ()=>{
              if (state.revealed.includes(i) || tile.dataset.matched) return;
              tile.textContent = sym; state.revealed.push(i);
              if (state.revealed.length === 2) {
                const [a,b] = state.revealed;
                if (deck[a] === deck[b]) {
                  // match
                  state.matches++;
                  grid.children[a].dataset.matched = '1';
                  grid.children[b].dataset.matched = '1';
                  state.revealed = [];
                  if (state.matches === 3) done({score:3});
                } else {
                  // flip back after short delay
                  setTimeout(()=>{
                    grid.children[a].textContent='?';
                    grid.children[b].textContent='?';
                    state.revealed = [];
                  }, 600);
                }
              }
            };
            grid.appendChild(tile);
          });
          container.appendChild(grid);
        }
      }
    ];

    /********* App logic *********/
    let current = null;
    const storageKey = 'mini_game_proto_data_v1';
    function loadData() {
      try {
        const raw = localStorage.getItem(storageKey);
        return raw ? JSON.parse(raw) : {games:{}, reviews:[]};
      } catch (e) { return {games:{}, reviews:[]}; }
    }
    function saveData(d) { localStorage.setItem(storageKey, JSON.stringify(d)); }

    function setCurrentTemplate(t) {
      current = t;
      document.getElementById('game-meta').innerHTML = `<div class="game-title">${t.name}</div><div class="small">${t.description}</div>`;
      document.getElementById('game-area').innerHTML = `<div class="small">Click "Play Current Game" to play <strong>${t.name}</strong>.</div>`;
      document.getElementById('play-end').style.display = 'none';
    }

    document.getElementById('btn-new').onclick = ()=>{
      const idx = Math.floor(Math.random()*templates.length);
      setCurrentTemplate(templates[idx]);
    };

    document.getElementById('btn-play').onclick = ()=>{
      if (!current) { alert('Generate a game first.'); return; }
      const area = document.getElementById('game-area');
      area.innerHTML = '<div class="small">Loading game...</div>';
      current.run(area, (result)=>{
        // show end modal
        document.getElementById('play-end').style.display = 'block';
        document.getElementById('end-title').textContent = `${current.name} ‚Äî Score: ${result.score}${result.survived===false ? ' (hit!)':''}`;
        // record a play
        const d = loadData();
        if (!d.games[current.id]) d.games[current.id] = {plays:0,likes:0,dislikes:0};
        d.games[current.id].plays++;
        saveData(d);
      });
    };

    let currentReviewType = null; // like or dislike
    document.getElementById('like').onclick = ()=> currentReviewType = 'like';
    document.getElementById('dislike').onclick = ()=> currentReviewType = 'dislike';

    document.getElementById('submit-review').onclick = ()=>{
      if (!current) { alert('No game to review'); return; }
      const comment = document.getElementById('review-text').value.trim();
      const d = loadData();
      const r = {gameId: current.id, type: currentReviewType || 'like', comment, ts: Date.now()};
      d.reviews.push(r);
      if (!d.games[current.id]) d.games[current.id] = {plays:0,likes:0,dislikes:0};
      if (r.type === 'like') d.games[current.id].likes++; else d.games[current.id].dislikes++;
      saveData(d);
      document.getElementById('review-text').value = '';
      currentReviewType = null;
      document.getElementById('play-end').style.display = 'none';
      alert('Thanks for the review! (local demo)');
      updateAdmin();
    };

    // admin
    document.getElementById('btn-admin').onclick = ()=>{
      const panel = document.getElementById('admin-panel');
      panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
      updateAdmin();
    };

    function updateAdmin(){
      const d = loadData();
      const content = document.getElementById('admin-content');
      let html = '<div class="small">Games summary:</div><ul>';
      for (const [id, g] of Object.entries(d.games)) {
        const tpl = templates.find(t=>t.id===id);
        html += `<li><strong>${tpl ? tpl.name : id}</strong> ‚Äî plays: ${g.plays || 0} ‚Äî üëç ${g.likes || 0} ‚Äî üëé ${g.dislikes || 0}</li>`;
      }
      html += '</ul><div style="margin-top:8px;"><strong>Recent reviews:</strong></div><ul>';
      const recent = (d.reviews||[]).slice(-10).reverse();
      if (recent.length===0) html += '<li class="small">No reviews yet.</li>';
      for (const r of recent) {
        const tpl = templates.find(t=>t.id===r.gameId);
        html += `<li><strong>${tpl ? tpl.name : r.gameId}</strong> ‚Äî ${r.type} ‚Äî <span class="small">${new Date(r.ts).toLocaleString()}</span><div>${r.comment ? r.comment : '<i>No comment</i>'}</div></li>`;
      }
      html += '</ul>';
      content.innerHTML = html;
    }

    document.getElementById('clear-local').onclick = ()=>{
      if (confirm('Clear local data?')) {
        localStorage.removeItem(storageKey);
        updateAdmin();
        alert('Local data cleared.');
      }
    };

    // init with a default template
    setCurrentTemplate(templates[0]);
    updateAdmin();
  </script>

</body>
</html>
